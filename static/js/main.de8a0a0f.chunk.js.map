{"version":3,"sources":["Turnips.module.css","LocaleSelect.module.css","icon-128.png","i18n/flags/en.gif","i18n/flags/jp.gif","i18n/i18n.ts","turnipCalculator.ts","Chart.tsx","storageService.ts","DelayedRender.tsx","urlService.ts","LocaleSelect.tsx","Turnips.tsx","App.tsx","serviceWorker.js","index.js"],"names":["module","exports","localizations","en","require","ja","locale","i18nGetLocale","getLocalized","str","localized","loc","window","localizationsNeeded","i18n","values","Object","keys","forEach","key","replace","randint","low","high","Math","floor","random","intceil","num","ceil","randfloat","patternNames","pattern0","basePrice","sellPrices","startPrice","work","hiPhaseLen1","decPhaseLen1","hiPhaseLen2and3","decPhaseLen2","hiPhaseLen3","i","rate","shift","predictPattern0","predictions","metadata","push","blankPrediction","daily","decreasingStart","variation","length","config","minRate","maxRate","pattern1","peakStart","predictPattern1","pattern2","predictPattern2","pattern3","predictPattern3","predictPattern","pattern","runPattern","patternProbability","lastPattern","possiblePatterns","firstWeek","maxMistakes","range","map","l","ld","ii","patterns","prob","idx","patternsTemp","prediction","dailyPriceRange","probability","type","mistakes","totalProb","reduce","a","b","reverse","expectedPrice","day","expectedPrices","expectedPricesHigh","expectedPricesLow","startDay","expectedMax","expectedHigh","expectedLow","expected","min","max","price","dailyPredictedPrice","simulateFromPrice","maxTime","allPrices","failedRuns","totalSellPrice","bestPossiblePrice","pop","probabilityMap","startTime","Date","now","runs","decreasingRuns","rand","result","attempts","buyPrice","unshift","match","thisMatches","j","maxPrice","knownData","isDecreasing","every","p","bestExpectedPrice","makeHistogram","prices","bucketSize","counts","round","c","Chart","props","d3Container","useRef","margin","width","height","useState","chartElements","setChartElements","useEffect","svg","remove","newSvg","d3","current","attr","append","style","dataArea","x","domain","options","xDomain","call","tickFormat","xTickFormat","y","yDomain","yTickFormat","title","text","data","callout","g","value","path","selectAll","join","split","d","_","node","getBBox","w","h","tooltip","on","mouse","this","selectedPoints","allXvalues","Set","areas","item","point","add","lines","closestX","xPos","invert","Array","from","xValue","abs","allLines","allAreas","allPoints","bisect","calloutMessage","xCallout","yCallout","newAreas","newLines","area","elem","datum","undefined","opacity","y0","y1","line","className","ref","memoryStore","USE_LOCAL_STORE","localStorage","getStore","dataStr","getItem","JSON","parse","setStore","setItem","stringify","DelayedRender","containerRef","observer","state","visible","visibleTimeout","observeHandler","entries","clearTimeout","isIntersecting","setTimeout","setState","unmountOnHidden","unobserve","delay","e","React","IntersectionObserver","observe","children","minWidth","minHeight","display","generateUrl","oldUrl","location","href","oldSearch","search","newSearch","indexOf","newUrl","baseUrl","shareUrl","iframeUrl","flags","console","log","locales","LocaleSelect","container","src","localeSelect","onChange","target","name","selected","urlPrices","queryPrices","getTurnipPricesUrl","history","pushState","resetUrl","turnipPriceStore","expiration","clear","storageService","simulationRun","lastLog","cleanPrices","PriceForm","setLastPattern","setPrices","showShare","setShowShare","changePrice","newPrices","parseFloat","debouncedValue","setDebouncedValue","handler","useDebounce","store","iframe","document","getElementById","setTurnipPricesUrl","instructions","parseInt","patternSelect","priceTable","formDay","placeholder","dayName","resetForm","onClick","confirm","currentPattern","shareLink","select","setSelectionRange","execCommand","id","Turnips","simulated","setSimulated","correctedPrices","groupings","minPrice","currentDay","group","filter","makeGroupings","currentPrice","last","charts","masterChart","chart","simulate","iterations","currentRun","res","Promise","r","histogram","func","deps","useDebounceFn","image","subTitle","ga","hitType","eventCategory","eventAction","eventLabel","logPrices","recommendation","response","newRes","splice","i18nJsx","color","groupingContainer","groupingForm","percent","fatData","flatMap","curLine","isNaN","yMax","yMin","App","queryLocale","navigator","userLanguage","language","getUserLanguage","toLocaleLowerCase","innerHTML","Boolean","hostname","ReactDOM","render","StrictMode","serviceWorker","ready","then","registration","unregister","catch","error","message","addEventListener","err","exDescription","exFatal"],"mappings":"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","file":"static/js/main.de8a0a0f.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Turnips_container__2Pf9Z\",\"title\":\"Turnips_title__3jrpL\",\"subTitle\":\"Turnips_subTitle__3w3Oo\",\"priceTable\":\"Turnips_priceTable__1R06m\",\"formDay\":\"Turnips_formDay__1WR1H\",\"recommendation\":\"Turnips_recommendation__1YEcW\",\"patternSelect\":\"Turnips_patternSelect__1x5LR\",\"instructions\":\"Turnips_instructions__3ei3j\",\"resetForm\":\"Turnips_resetForm__26NYJ\",\"shareLink\":\"Turnips_shareLink__36RHo\",\"groupingContainer\":\"Turnips_groupingContainer__3bfrt\",\"groupingForm\":\"Turnips_groupingForm__3RSpT\",\"percent\":\"Turnips_percent__3F4pn\",\"pattern2\":\"Turnips_pattern2__12sz2\",\"pattern0\":\"Turnips_pattern0__2YIVN\",\"pattern3\":\"Turnips_pattern3__2Ib-q\",\"pattern1\":\"Turnips_pattern1__3DRps\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"LocaleSelect_container__5_EbW\",\"localeSelect\":\"LocaleSelect_localeSelect__2o0hW\"};","module.exports = __webpack_public_path__ + \"static/media/icon-128.23da6b42.png\";","module.exports = \"data:image/gif;base64,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\"","module.exports = \"data:image/gif;base64,R0lGODlhgABWAIcAAPDw8NgAJ+u7w8XN4vLy8tkJLtsXOueUo99KZe7Y3ONwhd0yUeaQoO/m6OiotNwlRuFXcN4+W+R5jPDt7e7e4eeaqNkLMOu9xfDo6dkMMdsYOwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQEAAAAACwAAAAAgABWAAAI/wAHCBxIsKDBgwgTKkxIoKHDhxAjSpxIsSJFABgzatzIsaPHjyBDihxJsqTJkyhTqlzJsqXLlzBjypxJs6bNmzhz6tzJs6fPn0CDCh1KtKjRo0iTKl3KtKnTp1CjSp1KtarVq1izai2JwYECCBEeZMjwIAIEBQ4wbAVK4QCCAgHiyp0btwCCAxTW6mwgwQLdv4AtSGigt+YEBgYAKwZsgMGEwjETLFhMGfCCBJBdXtBQuTNdDRcyr6wA17PpuhVEo6xwurXc1KpJXijt+nSB0LFDJuBc27UGzLk9Tpjcu/aCx8E5MihenEHyjQ0SM69tgPBzjBKmF5dwHQAFv9prW//I+/xA+OIHriM43xvBcwy02dtWG9yB/N4Okiu4X1tBcgj8uQZBchEE2FoEyT1g4GkPJJfBgqZl4CCEnkkYnIIUVtZgcAVmSBmCwQHo4WIDBrffiIr5Vx+KiuUXHHws0lUAfcGtF6Nc7pV3o1zpPffdjuN1l92N3HUXXYzVdYfRciw6pyQAw6F43JMY7ebhb1RmNBuFt2WpEWsQwuZlRqQFWICYY2rJG3ugpdmRZOxd5qZwiE3XGHJzesQXeK0JZl2eIbX1Vmd24QXoSV19FdZYZZ2V1qGQRirppJRWaumlmGaq6aacdurpp6CGKuqopPokwKmopqrqqqy26uqrsMYHKuustLYaEAA7\"","const localizations: any = {\n  en: require(\"./en.json\"),\n  // de: require(\"./de.json\"),\n  ja: require(\"./ja.json\"),\n};\n\nlet locale = \"en\";\nexport function i18nSetLocale(newLocale: string) {\n  locale = newLocale.split(\"-\")[0].toLocaleLowerCase();\n}\nexport function i18nGetLocale() {\n  return locale;\n}\n\nexport function getUserLanguage() {\n  const queryLocale = window.location.search.match(/locale=([^&]+)/);\n  // console.log(queryLocale);\n  const locale = queryLocale?.[1];\n  return (\n    locale ||\n    (window?.navigator as any)?.userLanguage ||\n    window?.navigator?.language\n  );\n}\n\nfunction getLocalized(str: string): string {\n  const localized = localizations?.[locale]?.[str];\n  if (!localized) {\n    const loc = (window as any).localizationsNeeded || {};\n    loc[locale] = loc[locale] || {};\n    loc[locale][str] = str;\n    (window as any).localizationsNeeded = loc;\n    // console.log(`${locale} Localization needed for \"${str}\"`);\n  }\n  return localized || localizations?.[\"en\"]?.[str] || str;\n}\nexport function i18n(\n  str: string,\n  values?: { [key: string]: string | number }\n): string {\n  str = getLocalized(str);\n  if (values)\n    Object.keys(values).forEach((key) => {\n      str = str.replace(`{${key}}`, `${values[key]}`);\n    });\n  return str;\n}\nexport function i18nJsx(str: string, values: { [key: string]: any }): any[] {\n  str = getLocalized(str);\n  const response = [str];\n  Object.keys(values).forEach((key) => {\n    response.forEach((res, idx) => {\n      if (typeof res === \"string\") {\n        const newRes = res.split(`{${key}}`);\n        if (newRes.length === 2) {\n          response.splice(idx, 1, newRes[0], values[key], newRes[1]);\n        }\n      }\n    });\n  });\n  return response;\n}\n","// https://gist.github.com/Treeki/85be14d297c80c8b3c0a76375743325b\n\nimport { i18n } from \"./i18n/i18n\";\n// import { turnipProphetPredict } from \"./otherPatterns/turnipProphetPatterns\";\n// import { acTurnipsPredict } from \"./otherPatterns/acTurnipsPatterns\";\n\nconst randbool = () => Math.random() > 0.5;\nconst randint = (low: number, high: number) =>\n  Math.floor(Math.random() * (high - low + 1)) + low;\nconst intceil = (num: number) => Math.ceil(num);\nconst randfloat = (low: number, high: number) =>\n  Math.random() * (high - low) + low;\n\nexport interface Pattern {\n  dailyPriceRange: { low: number; high: number }[];\n  probability: number;\n  type: number; // 0|1|2|3;\n  decreasingStart: number; // first day of a decreasing pattern\n}\n\ninterface Grouping {\n  type: number; // 0|1|2|3;\n  probability: number;\n  minPrice: number;\n  maxPrice: number;\n}\n\nexport const patternNames = () => [\n  i18n(\"Fluctuating\"),\n  i18n(\"Large Spike\"),\n  i18n(\"Decreasing\"),\n  i18n(\"Small Spike\"),\n  i18n(\"Unknown\"),\n  i18n(\"First Time Buyer\"),\n];\n\nexport interface Prediction {\n  daily: [number, number][];\n  decreasingStart: number;\n}\n\n// 0.9 - 1.4 random\nfunction pattern0(basePrice: number) {\n  basePrice = basePrice || startPrice();\n  let sellPrices = [basePrice, basePrice];\n  // PATTERN 0: high, decreasing, high, decreasing, high\n  let work = 2;\n\n  const hiPhaseLen1 = randint(0, 6);\n  const decPhaseLen1 = randint(2, 3); // DEVIATION was 2-3\n  const hiPhaseLen2and3 = 7 - hiPhaseLen1;\n  const decPhaseLen2 = 5 - decPhaseLen1;\n  const hiPhaseLen3 = randint(0, hiPhaseLen2and3 - 1);\n\n  // high phase 1\n  for (let i = 0; i < hiPhaseLen1; i++) {\n    sellPrices[work++] = intceil(randfloat(0.9, 1.4) * basePrice);\n  }\n\n  // decreasing phase 1\n  let rate = randfloat(0.8, 0.6);\n  for (let i = 0; i < decPhaseLen1; i++) {\n    sellPrices[work++] = intceil(rate * basePrice);\n    rate -= 0.04;\n    rate -= randfloat(0, 0.06);\n  }\n\n  // high phase 2\n  for (let i = 0; i < hiPhaseLen2and3 - hiPhaseLen3; i++) {\n    sellPrices[work++] = intceil(randfloat(0.9, 1.4) * basePrice);\n  }\n\n  // decreasing phase 2\n  rate = randfloat(0.8, 0.6);\n  for (let i = 0; i < decPhaseLen2; i++) {\n    sellPrices[work++] = intceil(rate * basePrice);\n    rate -= 0.04;\n    rate -= randfloat(0, 0.06);\n  }\n\n  // high phase 3\n  for (let i = 0; i < hiPhaseLen3; i++) {\n    sellPrices[work++] = intceil(randfloat(0.9, 1.4) * basePrice);\n  }\n  sellPrices.shift();\n  sellPrices.shift();\n  return sellPrices;\n}\nfunction predictPattern0(sellPrices: number[]) {\n  const basePrice = sellPrices[0];\n  // [low, high] x 14 vals x prediction trees\n  let predictions: Prediction[] = [];\n  let metadata: {\n    decPhaseLen1: number;\n    hiPhaseLen1: number;\n    hiPhaseLen3: number;\n    hiPhaseLen2and3: number;\n    decPhaseLen2: number;\n  }[] = [];\n\n  [0, 1, 2, 3, 4, 5, 6].forEach((hiPhaseLen1) => {\n    // DEVIATION was 2-3\n    [2, 3].forEach((decPhaseLen1) => {\n      [0, 1, 2, 3, 4, 5, 6].forEach((hiPhaseLen3) => {\n        const hiPhaseLen2and3 = 7 - hiPhaseLen1;\n        const decPhaseLen2 = 5 - decPhaseLen1;\n        if (hiPhaseLen3 > hiPhaseLen2and3 - 1) return;\n\n        metadata.push({\n          decPhaseLen1,\n          hiPhaseLen1,\n          hiPhaseLen3,\n          hiPhaseLen2and3,\n          decPhaseLen2,\n        });\n        let blankPrediction: Prediction = { daily: [], decreasingStart: 14 };\n        for (let i = 0; i < 14; i++)\n          blankPrediction.daily.push([basePrice || 90, basePrice || 110]);\n        predictions.push(blankPrediction);\n      });\n    });\n  });\n\n  for (let variation = 0; variation < metadata.length; variation++) {\n    const config = metadata[variation];\n\n    // high phase 1\n    let work = 2;\n    for (let i = 0; i < config.hiPhaseLen1; i++) {\n      if (!sellPrices[work]) {\n        predictions[variation].daily[work][0] = Math.floor(0.9 * basePrice);\n        predictions[variation].daily[work][1] = Math.ceil(1.4 * basePrice);\n      }\n      work++;\n    }\n\n    // decreasing phase 1\n    let minRate = 0.6;\n    let maxRate = 0.8;\n    for (let i = 0; i < config.decPhaseLen1; i++) {\n      if (!sellPrices[work]) {\n        predictions[variation].daily[work][0] = Math.floor(minRate * basePrice);\n        predictions[variation].daily[work][1] = Math.ceil(maxRate * basePrice);\n      }\n      minRate -= 0.04 + 0.06;\n      maxRate -= 0.04;\n      work++;\n    }\n\n    // high phase 2\n    for (let i = 0; i < config.hiPhaseLen2and3 - config.hiPhaseLen3; i++) {\n      if (!sellPrices[work]) {\n        predictions[variation].daily[work][0] = Math.floor(0.9 * basePrice);\n        predictions[variation].daily[work][1] = Math.ceil(1.4 * basePrice);\n      }\n      work++;\n    }\n\n    if (config.hiPhaseLen3 === 0) predictions[variation].decreasingStart = work;\n\n    // decreasing phase 2\n    minRate = 0.6;\n    maxRate = 0.8;\n    for (let i = 0; i < config.decPhaseLen2; i++) {\n      if (!sellPrices[work]) {\n        predictions[variation].daily[work][0] = Math.floor(minRate * basePrice);\n        predictions[variation].daily[work][1] = Math.ceil(maxRate * basePrice);\n      }\n      minRate -= 0.04 + 0.06;\n      maxRate -= 0.04;\n      work++;\n    }\n    // high phase 3\n    for (let i = 0; i < config.hiPhaseLen3; i++) {\n      if (!sellPrices[work]) {\n        predictions[variation].daily[work][0] = Math.floor(0.9 * basePrice);\n        predictions[variation].daily[work][1] = Math.ceil(1.4 * basePrice);\n      }\n      work++;\n    }\n  }\n\n  return predictions;\n}\n// 2.0 - 6.0 large spike\nfunction pattern1(basePrice: number) {\n  basePrice = basePrice || startPrice();\n  let sellPrices = [basePrice, basePrice];\n  // PATTERN 1: decreasing middle, high spike, random low\n  const peakStart = randint(3, 9);\n  let rate = randfloat(0.9, 0.85);\n  let work = 2;\n  for (; work < peakStart; work++) {\n    sellPrices[work] = intceil(rate * basePrice);\n    rate -= 0.03;\n    rate -= randfloat(0, 0.02);\n  }\n  sellPrices[work++] = intceil(randfloat(0.9, 1.4) * basePrice);\n  sellPrices[work++] = intceil(randfloat(1.4, 2.0) * basePrice);\n  sellPrices[work++] = intceil(randfloat(2.0, 6.0) * basePrice);\n  sellPrices[work++] = intceil(randfloat(1.4, 2.0) * basePrice);\n  sellPrices[work++] = intceil(randfloat(0.9, 1.4) * basePrice);\n  for (; work < 14; work++) {\n    sellPrices[work] = intceil(randfloat(0.4, 0.9) * basePrice);\n  }\n  sellPrices.shift();\n  sellPrices.shift();\n  return sellPrices;\n}\nfunction predictPattern1(sellPrices: number[]) {\n  const basePrice = sellPrices[0];\n  // [low, high] x 14 vals x prediction trees\n  let predictions: Prediction[] = [];\n  let metadata: { peakStart: number }[] = [];\n\n  [3, 4, 5, 6, 7, 8, 9].forEach((peakStart) => {\n    metadata.push({ peakStart });\n    let blankPrediction: Prediction = { daily: [], decreasingStart: 14 };\n    for (let i = 0; i < 14; i++)\n      blankPrediction.daily.push([basePrice || 90, basePrice || 110]);\n    predictions.push(blankPrediction);\n  });\n\n  for (let variation = 0; variation < metadata.length; variation++) {\n    const config = metadata[variation];\n    let minRate = 0.85;\n    let maxRate = 0.9;\n    let work = 2;\n    for (; work < config.peakStart; work++) {\n      if (!sellPrices[work]) {\n        predictions[variation].daily[work][0] = Math.floor(minRate * basePrice);\n        predictions[variation].daily[work][1] = Math.ceil(maxRate * basePrice);\n      }\n      minRate -= 0.03 + 0.02;\n      maxRate -= 0.03;\n    }\n\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(0.9 * basePrice);\n      predictions[variation].daily[work][1] = Math.ceil(1.4 * basePrice);\n    }\n    work++;\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(1.4 * basePrice);\n      predictions[variation].daily[work][1] = Math.ceil(2.0 * basePrice);\n    }\n    work++;\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(2.0 * basePrice);\n      predictions[variation].daily[work][1] = Math.ceil(6.0 * basePrice);\n    }\n    work++;\n    predictions[variation].decreasingStart = work;\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(1.4 * basePrice);\n      predictions[variation].daily[work][1] = Math.ceil(2.0 * basePrice);\n    }\n    work++;\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(0.9 * basePrice);\n      predictions[variation].daily[work][1] = Math.ceil(1.4 * basePrice);\n    }\n    work++;\n\n    for (; work < 14; work++) {\n      if (!sellPrices[work]) {\n        predictions[variation].daily[work][0] = Math.floor(0.4 * basePrice);\n        predictions[variation].daily[work][1] = Math.ceil(0.9 * basePrice);\n      }\n    }\n  }\n\n  return predictions;\n}\n// 0.9 - 0.3 decreasing\nfunction pattern2(basePrice: number) {\n  basePrice = basePrice || startPrice();\n  let sellPrices = [basePrice, basePrice];\n  // PATTERN 2: consistently decreasing\n  let rate = 0.9;\n  rate -= randfloat(0, 0.05);\n  for (let work = 2; work < 14; work++) {\n    sellPrices[work] = intceil(rate * basePrice);\n    rate -= 0.03;\n    rate -= randfloat(0, 0.02);\n  }\n  sellPrices.shift();\n  sellPrices.shift();\n  return sellPrices;\n}\nfunction predictPattern2(sellPrices: number[]) {\n  const basePrice = sellPrices[0];\n  // [low, high] x 14 vals x prediction trees\n  let predictions: Prediction[] = [];\n\n  let blankPrediction: Prediction = { daily: [], decreasingStart: 14 };\n  for (let i = 0; i < 14; i++)\n    blankPrediction.daily.push([basePrice || 90, basePrice || 100]);\n  predictions.push(blankPrediction);\n\n  let minRate = 0.9;\n  let maxRate = 0.9;\n\n  minRate -= 0.05;\n  maxRate -= 0;\n  predictions[0].decreasingStart = 2;\n  for (let work = 2; work < 14; work++) {\n    for (let variation = 0; variation < predictions.length; variation++) {\n      if (!sellPrices[work]) {\n        predictions[variation].daily[work][0] = Math.floor(minRate * basePrice);\n        predictions[variation].daily[work][1] = Math.ceil(maxRate * basePrice);\n      }\n    }\n    minRate -= 0.03 + 0.02;\n    maxRate -= 0.03;\n  }\n  return predictions;\n}\n// 1.4 - 2.0 small spike\nfunction pattern3(basePrice: number) {\n  basePrice = basePrice || startPrice();\n  let sellPrices = [basePrice, basePrice];\n  // PATTERN 3: decreasing, spike, decreasing\n  const peakStart = randint(2, 9);\n\n  // decreasing phase before the peak\n  let rate = randfloat(0.9, 0.4);\n  let work = 2;\n  for (; work < peakStart; work++) {\n    sellPrices[work] = intceil(rate * basePrice);\n    rate -= 0.03;\n    rate -= randfloat(0, 0.02);\n  }\n\n  sellPrices[work++] = intceil(randfloat(0.9, 1.4) * basePrice);\n  sellPrices[work++] = intceil(randfloat(0.9, 1.4) * basePrice);\n  rate = randfloat(1.4, 2.0);\n  sellPrices[work++] = intceil(randfloat(1.4, rate) * basePrice) - 1;\n  sellPrices[work++] = intceil(rate * basePrice);\n  sellPrices[work++] = intceil(randfloat(1.4, rate) * basePrice) - 1;\n\n  // decreasing phase after the peak\n  if (work < 14) {\n    rate = randfloat(0.9, 0.4);\n    for (; work < 14; work++) {\n      sellPrices[work] = intceil(rate * basePrice);\n      rate -= 0.03;\n      rate -= randfloat(0, 0.02);\n    }\n  }\n\n  sellPrices.shift();\n  sellPrices.shift();\n  return sellPrices;\n}\nfunction predictPattern3(sellPrices: number[]) {\n  const basePrice = sellPrices[0];\n  // [low, high] x 14 vals x prediction trees\n  let predictions: Prediction[] = [];\n  let metadata: { peakStart: number }[] = [];\n\n  [2, 3, 4, 5, 6, 7, 8, 9].forEach((peakStart) => {\n    metadata.push({ peakStart });\n    let blankPrediction: Prediction = { daily: [], decreasingStart: 14 };\n    for (let i = 0; i < 14; i++)\n      blankPrediction.daily.push([basePrice || 90, basePrice || 110]);\n    predictions.push(blankPrediction);\n  });\n\n  for (let variation = 0; variation < metadata.length; variation++) {\n    const config = metadata[variation];\n    let minRate = 0.4;\n    let maxRate = 0.9;\n    let work = 2;\n    for (; work < config.peakStart; work++) {\n      if (!sellPrices[work]) {\n        predictions[variation].daily[work][0] = Math.floor(minRate * basePrice);\n        predictions[variation].daily[work][1] = Math.ceil(maxRate * basePrice);\n      }\n      minRate -= 0.03 + 0.02;\n      maxRate -= 0.03;\n    }\n\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(0.9 * basePrice);\n      predictions[variation].daily[work][1] = Math.ceil(1.4 * basePrice);\n    }\n    work++;\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(0.9 * basePrice);\n      predictions[variation].daily[work][1] = Math.ceil(1.4 * basePrice);\n    }\n    work++;\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(1.4 * basePrice) - 1;\n      predictions[variation].daily[work][1] = Math.ceil(2 * basePrice) - 1;\n    }\n    work++;\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(1.4 * basePrice);\n      predictions[variation].daily[work][1] = Math.ceil(2 * basePrice);\n    }\n    work++;\n    if (!sellPrices[work]) {\n      predictions[variation].daily[work][0] = Math.floor(1.4 * basePrice) - 1;\n      predictions[variation].daily[work][1] = Math.ceil(2 * basePrice) - 1;\n    }\n    work++;\n\n    predictions[variation].decreasingStart = work;\n\n    if (work < 14) {\n      minRate = 0.4;\n      maxRate = 0.9;\n      for (; work < 14; work++) {\n        if (!sellPrices[work]) {\n          predictions[variation].daily[work][0] = Math.floor(\n            minRate * basePrice\n          );\n          predictions[variation].daily[work][1] = Math.ceil(\n            maxRate * basePrice\n          );\n        }\n        minRate -= 0.03 + 0.02;\n        maxRate -= 0.03;\n      }\n    }\n  }\n\n  return predictions;\n}\nfunction predictPattern(pattern: number, sellPrices: number[]) {\n  if (pattern === 0) return predictPattern0(sellPrices);\n  if (pattern === 1) return predictPattern1(sellPrices);\n  if (pattern === 2) return predictPattern2(sellPrices);\n  if (pattern === 3) return predictPattern3(sellPrices);\n  return [];\n}\n\nexport function runPattern(pattern: number, basePrice: number) {\n  if (pattern === 0) return pattern0(basePrice);\n  if (pattern === 1) return pattern1(basePrice);\n  if (pattern === 2) return pattern2(basePrice);\n  if (pattern === 3) return pattern3(basePrice);\n  return [];\n}\n\nfunction whichPattern(lastPattern: number) {\n  const chance = randint(0, 99);\n  switch (lastPattern) {\n    case 0:\n      if (chance < 20) return 0; // 20\n      if (chance < 50) return 1; // 30\n      if (chance < 65) return 2; // 15\n      return 3; // 35\n    case 1:\n      if (chance < 50) return 0; // 50\n      if (chance < 55) return 1; // 5\n      if (chance < 75) return 2; // 20\n      return 3; // 25\n    case 2:\n      if (chance < 25) return 0; // 25\n      if (chance < 70) return 1; // 45\n      if (chance < 75) return 2; // 5\n      return 3; // 25\n    case 3:\n      if (chance < 45) return 0; // 45\n      if (chance < 70) return 1; // 25\n      if (chance < 85) return 2; // 15\n      return 3; // 15\n  }\n  return 2;\n}\n// [\n//   \"Random\",\n//   \"Large Spike\",\n//   \"Decreasing\",\n//   \"Small Spike\"\n// ];\nfunction patternProbability(lastPattern: number) {\n  if (lastPattern === 0) return [0.2, 0.3, 0.15, 0.35];\n  if (lastPattern === 1) return [0.5, 0.05, 0.2, 0.25];\n  if (lastPattern === 2) return [0.25, 0.45, 0.05, 0.25];\n  if (lastPattern === 3) return [0.45, 0.25, 0.15, 0.15];\n  return [0.35, 0.25, 0.15, 0.25];\n}\nexport function startPrice() {\n  return randint(90, 110);\n}\n\n// [buy, buy, mon am, mon pm, tue am, tue pm...]\nexport function possiblePatterns(\n  sellPrices: number[],\n  lastPattern: number = -1,\n  firstWeek = false,\n  maxMistakes = 0\n): { patterns: Pattern[]; maxMistakes: number } {\n  if (lastPattern === 5) firstWeek = true;\n  // console.log(sellPrices);\n  const startPrice = [...sellPrices];\n  for (let i = 2; i < startPrice.length; i++) startPrice[i] = 0;\n  let predictions: Prediction[][] = [];\n\n  if (firstWeek || !startPrice) {\n    for (let i = 0; i < 4; i++) {\n      const low = predictPattern(i, [90]);\n      const high = predictPattern(i, [110]);\n      const range = low.map((l, i) => {\n        l.daily.forEach((ld, ii) => {\n          ld[1] = high[i].daily[ii][1];\n        });\n        return l;\n      });\n      predictions[i] = range;\n    }\n  } else {\n    predictions = [\n      predictPattern0(startPrice),\n      predictPattern1(startPrice),\n      predictPattern2(startPrice),\n      predictPattern3(startPrice),\n    ];\n  }\n\n  // if (2 > 1) predictions = turnipProphetPredict(startPrice[0]);\n  // if (2 > 1) predictions = acTurnipsPredict(startPrice);\n\n  // let text: string[] = [];\n  // let csv: string[] = [];\n  let patterns: Pattern[] = [];\n\n  const prob = patternProbability(lastPattern);\n\n  // has 4 patterns\n  predictions.forEach((predictions, idx) => {\n    const patternsTemp: typeof patterns = [];\n\n    // all predictions in this pattern\n    predictions.forEach((prediction) => {\n      const pattern: typeof patterns[0] = {\n        dailyPriceRange: [],\n        probability: 0,\n        type: idx,\n        decreasingStart: prediction.decreasingStart,\n      };\n\n      // daily prediction\n      for (let i = 0; i < 2; i++) {\n        pattern.dailyPriceRange.push({\n          high: sellPrices[i] || prediction.daily[i][0],\n          low: sellPrices[i] || prediction.daily[i][1],\n        });\n      }\n      let mistakes = 0;\n      for (let i = 2; i < prediction.daily.length; i++) {\n        const low = prediction.daily[i][0];\n        const high = prediction.daily[i][1];\n\n        if (!low) return;\n        if (!high) return;\n\n        // skip if not within range\n        if (sellPrices[i] && sellPrices[i] < low) mistakes++;\n        if (sellPrices[i] && sellPrices[i] > high) mistakes++;\n\n        pattern.dailyPriceRange.push({\n          high: high,\n          low: low,\n        });\n      }\n      if (mistakes > maxMistakes) return;\n      // this is a valid pattern, add it\n      patternsTemp.push(pattern);\n    });\n\n    // probability of each pattern in the prediction\n    patternsTemp.forEach((pattern) => {\n      pattern.probability = prob[idx] / predictions.length;\n    });\n\n    patterns.push(...patternsTemp);\n  });\n\n  // normalize probabilities\n  const totalProb = patterns.reduce((a, b) => a + b.probability, 0);\n  patterns.forEach(\n    (pattern) => (pattern.probability = pattern.probability / totalProb)\n  );\n\n  if (!patterns.length && !firstWeek)\n    return possiblePatterns(sellPrices, lastPattern, true);\n\n  if (!patterns.length && maxMistakes < 10)\n    return possiblePatterns(\n      sellPrices,\n      lastPattern,\n      firstWeek,\n      maxMistakes + 1\n    );\n\n  // patterns.sort((a, b) => b.type - a.type);\n  patterns.reverse();\n\n  return { patterns, maxMistakes };\n}\n\nexport function dailyPredictedPrice(patterns: Pattern[]) {\n  let expectedPrices: number[] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n  let expectedPricesHigh: number[] = [];\n  let expectedPricesLow: number[] = [];\n  patterns.forEach((pattern) => {\n    for (let startDay = 2; startDay < 14; startDay++) {\n      let expectedMax = 0;\n      let expectedHigh = 0;\n      let expectedLow = 0;\n      for (let day = startDay; day < 14; day++) {\n        const high = pattern.dailyPriceRange[day].high;\n        const low = pattern.dailyPriceRange[day].low;\n        const expected = (high + low) / 2;\n        if (expectedMax < expected) {\n          expectedMax = expected;\n          expectedHigh = high;\n          expectedLow = low;\n        }\n      }\n      expectedPrices[startDay] += expectedMax * pattern.probability;\n      expectedPricesLow[startDay] = Math.min(\n        expectedPricesLow[startDay] || 99999,\n        expectedLow\n      );\n      expectedPricesHigh[startDay] = Math.max(\n        expectedPricesHigh[startDay] || 0,\n        expectedHigh\n      );\n    }\n  });\n  return {\n    price: expectedPrices,\n    low: expectedPricesLow,\n    high: expectedPricesHigh,\n  };\n}\n\nexport function expectedPrice(patterns: Pattern[], day: number) {\n  const expectedPrices = dailyPredictedPrice(patterns);\n  let expected = 0;\n  let high = 0;\n  let low = 0;\n  for (let i = day; i < 14; i++) {\n    if (expectedPrices.price[i] > expected) {\n      expected = expectedPrices.price[i];\n      high = expectedPrices.high[i];\n      low = expectedPrices.low[i];\n    }\n  }\n  return { expected, high, low };\n}\n\nexport function simulation(runs = 1000) {\n  let pattern = 2;\n\n  let totalProfit = 0;\n\n  for (let i = 0; i < runs; i++) {\n    const basePrice = startPrice();\n    const result =\n      pattern === 0\n        ? pattern0(basePrice)\n        : pattern === 1\n        ? pattern1(basePrice)\n        : pattern === 2\n        ? pattern2(basePrice)\n        : pattern === 3\n        ? pattern3(basePrice)\n        : [];\n\n    result.unshift(basePrice);\n    result.unshift(basePrice);\n\n    for (let i = 3; i < 14; i++) {\n      const knownData = [...result];\n      for (let j = i; j < 14; j++) knownData[j] = 0;\n      const { patterns } = possiblePatterns(knownData);\n      const { expected } = expectedPrice(patterns, i + 1);\n      const price = result[i];\n      // if (price > 125 || i === 13) {\n      //   const gain = Math.floor((1000 * (price - basePrice)) / basePrice) / 10;\n      //   totalProfit += gain;\n      //   console.log(\n      //     `Sell on day ${i - 2} at price ${price} return of ${gain}%`\n      //   );\n      //   break;\n      // }\n      if (expected <= price || i === 13) {\n        const gain = Math.floor((1000 * (price - basePrice)) / basePrice) / 10;\n        totalProfit += gain;\n        console.log(\n          `Sell on day ${i - 2} at price ${price} return of ${gain}%`\n        );\n        break;\n      }\n    }\n    pattern = whichPattern(pattern);\n  }\n\n  console.log(\"Expected money from investing $100\", totalProfit / runs + 100);\n}\n\nexport function simulateFromPrice(\n  sellPrices: number[],\n  lastPattern: number = -1,\n  maxTime = 1000\n) {\n  let allPrices: number[] = [];\n  let failedRuns = 0;\n  let totalSellPrice = 0;\n  let bestPossiblePrice = 0;\n  sellPrices = [...sellPrices];\n  while (sellPrices.length && !sellPrices[sellPrices.length - 1])\n    sellPrices.pop();\n\n  const { patterns } = possiblePatterns(sellPrices, lastPattern);\n  const probabilityMap = [0, 0, 0, 0];\n  patterns.forEach(\n    (pattern) => (probabilityMap[pattern.type] += pattern.probability)\n  );\n  for (let i = 1; i < 4; i++) probabilityMap[i] += probabilityMap[i - 1]; // make cumulitive probability\n\n  const startTime = Date.now();\n  const basePrice = sellPrices[0];\n\n  let runs = 0;\n  let decreasingRuns = 0;\n  while (Date.now() - startTime < maxTime) {\n    runs++;\n\n    const rand = Math.random();\n    const type =\n      rand < probabilityMap[0]\n        ? 0\n        : rand < probabilityMap[1]\n        ? 1\n        : rand < probabilityMap[2]\n        ? 2\n        : 3;\n    let result: number[] = [];\n    let attempts = 0;\n    const buyPrice = basePrice || 100; //startPrice();\n    while (true) {\n      result = runPattern(type, buyPrice);\n      result.unshift(buyPrice);\n      result.unshift(buyPrice);\n      // make sure it matches a possible pattern\n      let match = false;\n      patterns.forEach((pattern) => {\n        let thisMatches = true;\n        pattern.dailyPriceRange.forEach((price, idx) => {\n          if (idx <= 1) return;\n          if (price.high < result[idx]) thisMatches = false;\n          if (price.low > result[idx]) thisMatches = false;\n        });\n        if (thisMatches) match = true;\n      });\n      if (match) break;\n      if (attempts++ > 100) {\n        failedRuns++;\n        break;\n      }\n    }\n    if (attempts > 100) continue;\n\n    // make the randomized result start the same as current sell prices\n    for (let j = 0; j < sellPrices.length; j++) result[j] = sellPrices[j];\n\n    // find the max price with perfect knowledge of the future\n    let maxPrice = 0;\n    for (let i = sellPrices.length - 1; i < 14; i++) {\n      if (result[i] > maxPrice) maxPrice = result[i];\n    }\n    bestPossiblePrice += maxPrice;\n\n    for (let i = sellPrices.length; i < 14; i++) {\n      const knownData = [...result];\n      for (let j = i + 1; j < 14; j++) knownData[j] = 0;\n      const { patterns } = possiblePatterns(knownData);\n      const { expected } = expectedPrice(patterns, i + 1);\n      let price = result[i];\n      // if (price > 125 || i === 13) {\n      //   const gain = Math.floor((1000 * (price - basePrice)) / basePrice) / 10;\n      //   totalSellPrice += gain;\n      //   console.log(\n      //     `Sell on day ${i - 2} at price ${price} return of ${gain}%`\n      //   );\n      //   break;\n      // }\n      const isDecreasing = patterns.every((p) => p.decreasingStart <= i);\n      if (isDecreasing && i === sellPrices.length) {\n        price = sellPrices[i - 1];\n        decreasingRuns++;\n      }\n      if (expected <= price || i === 13 || isDecreasing) {\n        totalSellPrice += price;\n        // console.log(result);\n        // console.log(\n        //   `Sell on day ${i -\n        //     2} at price ${price} return of ${gain}% - expected = ${expected}`\n        // );\n        // if (price < 40) console.log(knownData);\n        allPrices.push(price);\n        break;\n      }\n    }\n  }\n\n  // console.log(\"Expected money from investing $100\", totalProfit / RUNS + 100);\n  return {\n    expectedPrice: totalSellPrice / (runs - failedRuns),\n    bestExpectedPrice: bestPossiblePrice / (runs - failedRuns),\n    allPrices,\n    isDecreasing: runs - failedRuns === decreasingRuns,\n  };\n}\n\nexport function makeHistogram(prices: number[], bucketSize: number) {\n  const counts: number[] = [];\n  for (let i = 0; i <= 700; i += bucketSize) counts[i / bucketSize] = 0;\n\n  prices.forEach((price) => {\n    const idx = Math.round(price / bucketSize);\n    counts[idx]++;\n  });\n  counts.forEach((c, i) => (counts[i] = (c / prices.length) * 100));\n  return counts;\n}\n\nexport function makeGroupings(\n  prices: number[],\n  patterns: Pattern[]\n): Grouping[] {\n  const groupings: Grouping[] = [];\n  for (let i = 0; i < 4; i++) {\n    groupings.push({\n      probability: 0,\n      type: i,\n      minPrice: 660,\n      maxPrice: 0,\n    });\n  }\n\n  let currentDay = 0;\n  let currentPrice = 0;\n  prices.forEach((p, i) => {\n    if (p) {\n      currentDay = i;\n      currentPrice = p;\n    }\n  });\n\n  patterns.forEach((p) => {\n    const group = groupings[p.type];\n    group.probability += p.probability;\n    if (p.type !== 2) {\n      group.minPrice = Math.min(\n        group.minPrice,\n        Math.max(\n          ...p.dailyPriceRange\n            .filter((_, i) => i >= currentDay)\n            .map((i) => i.low)\n        )\n      );\n      group.maxPrice = Math.max(\n        group.maxPrice,\n        Math.max(\n          ...p.dailyPriceRange\n            .filter((_, i) => i >= currentDay)\n            .map((i) => i.high)\n        )\n      );\n    } else {\n      //decreasing\n      group.minPrice = p.dailyPriceRange[Math.max(currentDay, 9)].low;\n      group.maxPrice = p.dailyPriceRange[Math.max(currentDay, 9)].high;\n    }\n  });\n\n  return [groupings[2], groupings[0], groupings[3], groupings[1]];\n}\n\n// const prices = simulateFromPrice([100, 100, 90, 85], 0);\n// const hist = histogram(prices);\n// console.log(hist.join(\"\\n\"));\n\n// console.log(possiblePatterns([98, 98, 59, 55, 51, 48, 44, 41, 38, 120, 154]));\n// simulation();\n// console.log(predictPattern0([100, 100]));\n\n// console.log(possiblePatterns([100]).csv.join(\"\\n\"));\n","import React, { useRef, useEffect, useState } from \"react\";\nimport * as d3 from \"d3\";\n// https://www.d3-graph-gallery.com/graph/line_confidence_interval.html\n\ninterface Area {\n  x: number;\n  y0: number;\n  y1: number;\n}\ninterface Line {\n  x: number;\n  y: number;\n}\n\nexport interface ChartData {\n  lines: { data: Line[] }[];\n  areas: { opacity?: number; data: Area[] }[];\n  title: string;\n}\n\ninterface SelectedPoints {\n  allLines: Line[];\n  allAreas: Area[];\n  allPoints: (Line | Area)[];\n}\n\ninterface IProps {\n  data: ChartData;\n  options: {\n    yDomain: [number, number];\n    xDomain: [number, number];\n    yTickFormat?: any;\n    xTickFormat?: any;\n  };\n  calloutMessage?: {\n    (selected: SelectedPoints): {\n      text: string;\n      yCallout?: number;\n      xCallout?: number;\n    };\n  };\n}\n\ninterface ChartElements {\n  svg: d3.Selection<SVGGElement, unknown, null, undefined>;\n  dataArea: d3.Selection<SVGGElement, unknown, null, undefined>;\n  title: d3.Selection<SVGTextElement, unknown, null, undefined>;\n  x: d3.ScaleLinear<number, number>;\n  y: d3.ScaleLinear<number, number>;\n  areas: d3.Selection<SVGPathElement, Area[], null, undefined>[];\n  lines: d3.Selection<SVGPathElement, Line[], null, undefined>[];\n}\ntype GenericSelection = d3.Selection<any, any, any, any>;\n\nexport const Chart = (props: IProps) => {\n  const d3Container = useRef(null);\n\n  // set the dimensions and margins of the graph\n  const margin = { top: 10, right: 30, bottom: 30, left: 60 },\n    width = 380 - margin.left - margin.right,\n    height = 360 - margin.top - margin.bottom;\n\n  const [chartElements, setChartElements] = useState(\n    null as ChartElements | null\n  );\n\n  useEffect(() => {\n    if (chartElements?.svg) chartElements.svg.remove();\n\n    // append the svg object to the body of the page\n    const newSvg = d3\n      .select(d3Container.current)\n      .attr(\"width\", width + margin.left + margin.right)\n      .attr(\"height\", height + margin.top + margin.bottom)\n      .append(\"g\")\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    newSvg\n      .append(\"rect\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .style(\"fill\", \"rgba(0,0,0,0)\");\n\n    const dataArea = newSvg.append(\"g\");\n\n    // Add X axis --> it is a date format\n    const x = d3.scaleLinear().domain(props.options.xDomain).range([0, width]);\n    newSvg\n      .append(\"g\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .call(d3.axisBottom(x).tickFormat(props.options.xTickFormat));\n\n    // Add Y axis\n    const y = d3.scaleLinear().domain(props.options.yDomain).range([height, 0]);\n    newSvg\n      .append(\"g\")\n      .call(d3.axisLeft(y).tickFormat(props.options.yTickFormat));\n\n    // add the title\n    const title = newSvg\n      .append(\"text\")\n      .attr(\"x\", width / 2)\n      .attr(\"y\", 0 + margin.top)\n      .attr(\"text-anchor\", \"middle\")\n      .style(\"font-size\", \"16px\")\n      .text(props.data.title);\n\n    // add the hover callout\n    const bisect = (mouse: [number, number]): SelectedPoints => {\n      // mouse = [x,y] coordinates of the mouse\n\n      const allXvalues = new Set<number>();\n      props?.data?.areas?.forEach((item) =>\n        item.data.forEach((point) => allXvalues.add(point.x))\n      );\n      props?.data?.lines?.forEach((item) =>\n        item.data.forEach((point) => allXvalues.add(point.x))\n      );\n\n      let closestX = 0;\n      const xPos = x.invert(mouse[0]);\n      Array.from(allXvalues).forEach((xValue) => {\n        if (closestX === 0) closestX = xValue;\n        if (Math.abs(xPos - xValue) < Math.abs(xPos - closestX))\n          closestX = xValue;\n      });\n\n      const allLines = [] as Line[];\n      const allAreas = [] as Area[];\n      props?.data?.areas?.forEach((item) =>\n        item.data.forEach(\n          (point) => point.x === closestX && allAreas.push(point)\n        )\n      );\n      props?.data?.lines?.forEach((item) =>\n        item.data.forEach(\n          (point) => point.x === closestX && allLines.push(point)\n        )\n      );\n\n      return {\n        allAreas,\n        allLines,\n        allPoints: [...allAreas, ...allLines],\n      };\n    };\n\n    const callout = (g: GenericSelection, value: string) => {\n      if (!value) return g.style(\"display\", \"none\");\n\n      g.style(\"display\", null)\n        .style(\"pointer-events\", \"none\")\n        .style(\"font\", \"10px sans-serif\");\n\n      const path = g\n        .selectAll(\"path\")\n        .data([null])\n        .join(\"path\")\n        .attr(\"fill\", \"white\")\n        .attr(\"stroke\", \"black\");\n\n      const text = g\n        .selectAll(\"text\")\n        .data([null])\n        .join(\"text\")\n        .call((text) =>\n          text\n            .selectAll(\"tspan\")\n            .data((value + \"\").split(/\\n/))\n            .join(\"tspan\")\n            .attr(\"x\", 0)\n            .attr(\"y\", (d, i) => `${i * 1.1}em`)\n            .style(\"font-weight\", (_, i) => (i ? null : \"bold\"))\n            .text((d) => d)\n        );\n\n      const { y, width: w, height: h } = (text as any).node().getBBox();\n\n      text.attr(\"transform\", `translate(${-w / 2},${-27 - y})`);\n      /*\n      m 185 189\n      h 62\n      l 5 5\n      l 5 -5\n      h 62\n      v -32\n      h -135\n      z\n\n      */\n      path.attr(\n        \"d\",\n        `M${-w / 2 - 10},-5H-5l5,5l5,-5H${w / 2 + 10}v-${h + 20}h-${w + 20}z`\n      );\n    };\n\n    const tooltip = newSvg.append(\"g\");\n\n    newSvg.on(\"touchmove mousemove\", function () {\n      const mouse = d3.mouse(this);\n      const selectedPoints = bisect(mouse);\n      if (!selectedPoints.allPoints.length || !props.calloutMessage) return;\n\n      const xPos = selectedPoints.allPoints[0]?.x;\n      // const yPos = allLines[0]?.y;\n      // const yMax = Math.max(...(allAreas || []).map(p => p.y1));\n      // const yMin = Math.min(...(allAreas || []).map(p => p.y0));\n\n      // const text = `Max ${yMax}, Min ${yMin}, value ${yPos}`;\n\n      const { text, xCallout, yCallout } = props.calloutMessage(selectedPoints);\n\n      tooltip\n        .attr(\n          \"transform\",\n          `translate(${x(xCallout || xPos)},${\n            yCallout ? y(yCallout) : mouse[1]\n          })`\n        )\n        .call(callout, text);\n    });\n\n    newSvg.on(\"touchend mouseleave\", () => tooltip.call(callout, null));\n\n    // persist everything\n    setChartElements({\n      ...chartElements,\n      svg: newSvg,\n      dataArea,\n      x,\n      y,\n      title,\n      areas: [],\n      lines: [],\n    });\n  }, [props.options]);\n\n  useEffect(() => {\n    setChartElements((chartElements) => {\n      if (!chartElements) return chartElements;\n\n      const { dataArea, x, y, areas, lines } = chartElements;\n      const newAreas: typeof areas = [];\n      const newLines: typeof lines = [];\n\n      props.data.areas.forEach((area, idx) => {\n        const elem = areas[idx] || dataArea.append(\"path\");\n        newAreas[idx] = elem;\n        elem\n          .datum(area.data)\n          .attr(\"fill\", \"#cce5df\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"opacity\", area.opacity !== undefined ? area.opacity : 1)\n          .attr(\n            \"d\",\n            d3\n              .area<Area>()\n              .x((d) => x(d.x))\n              .y0((d) => y(d.y0))\n              .y1((d) => y(d.y1))\n          );\n      });\n\n      props.data.lines.forEach((line, idx) => {\n        const elem = lines[idx] || dataArea.append(\"path\");\n        newLines[idx] = elem;\n        elem\n          .datum(line.data)\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"steelblue\")\n          .attr(\"stroke-width\", 1.5)\n          .attr(\n            \"d\",\n            d3\n              .line<Line>()\n              .x((d) => x(d.x))\n              .y((d) => y(d.y))\n          );\n      });\n\n      for (let i = newAreas.length; i < areas.length; i++) areas[i].remove();\n      for (let i = newLines.length; i < lines.length; i++) lines[i].remove();\n      return { ...chartElements, areas: newAreas, lines: newLines };\n    });\n  }, [props.data, chartElements?.svg]);\n\n  return (\n    <>\n      <svg\n        className=\"d3-component\"\n        width={400}\n        height={200}\n        ref={d3Container}\n      />\n    </>\n  );\n};\n\n// /* App */\n// export const MyApp = () => {\n//   return (\n//     <div className=\"my-app\">\n//       <MyD3Component data={[1, 2, 3]} />\n//     </div>\n//   );\n// };\n","interface StorageItem {\n  expiration: number;\n  value: any;\n}\n\ninterface DataStore {\n  [prop: string]: StorageItem;\n}\n\nlet memoryStore: DataStore = {};\n\nconst USE_LOCAL_STORE = typeof localStorage !== \"undefined\";\nconst LOCAL_STORE_KEY = \"MONETFE_DATA_STORE\";\nconst VALUE_EXPIRATION = 14 * 24 * 60 * 60 * 1000;\nconst EXPIRATION_CHECK_INTERVAL = 60 * 60 * 1000;\n\nlet lastExpirationCheck = 0;\nfunction checkForExpired() {\n  if (Date.now() < lastExpirationCheck + EXPIRATION_CHECK_INTERVAL) return;\n  const store = getStore();\n  Object.keys(store).forEach(key => {\n    if (store[key].expiration < Date.now()) delete store[key];\n  });\n  setStore(store);\n  lastExpirationCheck = Date.now();\n}\n\nfunction getStore(): DataStore {\n  if (USE_LOCAL_STORE) {\n    const dataStr = localStorage.getItem(LOCAL_STORE_KEY);\n    if (dataStr) return JSON.parse(dataStr);\n  }\n  return memoryStore;\n}\n\nfunction setStore(value: DataStore) {\n  memoryStore = value;\n  if (USE_LOCAL_STORE) {\n    localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify(value));\n  }\n}\n\nfunction set(key: string, value: any, expiration = VALUE_EXPIRATION) {\n  const store = getStore();\n  store[key] = {\n    expiration: Date.now() + expiration,\n    value\n  };\n  setStore(store);\n  return value;\n}\n\nfunction get(key: string) {\n  const data = getStore()[key];\n  if (!data) return;\n  if (data.expiration < Date.now()) return clear(key);\n  return data.value;\n}\n\nfunction clear(key: string) {\n  const data = getStore();\n  delete data[key];\n  setStore(data);\n}\n\nexport { set, get, clear, checkForExpired };\n","import * as React from \"react\";\n\ninterface DelayedRenderProps {\n  width: string | number;\n  height: string | number;\n  delay?: number;\n  unmountOnHidden?: boolean;\n}\ninterface DelayedRenderState {\n  visible: boolean;\n}\nclass DelayedRender extends React.PureComponent<\n  DelayedRenderProps,\n  DelayedRenderState\n> {\n  containerRef: React.RefObject<any>;\n  observer: IntersectionObserver | null = null;\n  state = {\n    visible: false,\n  };\n  constructor(props: DelayedRenderProps) {\n    super(props);\n    this.containerRef = React.createRef();\n  }\n  visibleTimeout: NodeJS.Timeout | null = null;\n  observeHandler = (entries: IntersectionObserverEntry[]) => {\n    try {\n      if (this.visibleTimeout) clearTimeout(this.visibleTimeout);\n      if (entries[0].isIntersecting && !this.state.visible) {\n        this.visibleTimeout = setTimeout(() => {\n          this.setState({ visible: true });\n          if (!this.props.unmountOnHidden) {\n            this.observer && this.observer.unobserve(this.containerRef.current);\n          }\n        }, this.props.delay || 0);\n      } else if (\n        this.props.unmountOnHidden &&\n        !entries[0].isIntersecting &&\n        this.state.visible\n      ) {\n        this.setState({ visible: false });\n      }\n    } catch (e) {\n      this.setState({ visible: true });\n    }\n  };\n  componentDidMount() {\n    try {\n      this.observer = new IntersectionObserver(this.observeHandler);\n      this.observer.observe(this.containerRef.current);\n    } catch (e) {\n      this.setState({ visible: true });\n    }\n  }\n  componentWillUnmount() {\n    try {\n      if (this.visibleTimeout) clearTimeout(this.visibleTimeout);\n      this.observer && this.observer.unobserve(this.containerRef.current);\n      this.observer = null;\n    } catch (e) {}\n  }\n  render() {\n    const { width, height, children, ...props } = this.props;\n    return (\n      <div\n        style={{\n          minWidth: width,\n          minHeight: height,\n          display: \"inline-block\",\n        }}\n        ref={this.containerRef}\n        {...props}\n      >\n        {this.state.visible ? children : null}\n      </div>\n    );\n  }\n}\n\nexport default DelayedRender;\n","export function getTurnipPricesUrl() {\n  try {\n    const queryPrices = window.location.search.match(/prices=([^&]+)/);\n    if (!queryPrices) return null;\n    const prices: number[] = JSON.parse(queryPrices[1]);\n    const lastPattern = prices.shift();\n    prices.unshift(prices[0]);\n    if (!prices.length) return null;\n    if (prices.length > 14) return null;\n    return { prices, lastPattern };\n  } catch (e) {\n    return null;\n  }\n}\nlet lastIframeUrl = \"\";\nexport function setTurnipPricesUrl(data: {\n  prices: number[];\n  lastPattern: number;\n  maxMistakes: number;\n}) {\n  try {\n    const { iframeUrl, baseUrl } = generateUrl(data);\n    // if (lastIframeUrl !== iframeUrl) {\n    //   window.history.pushState(deepCopy(data), \"\", oldUrl);\n    // }\n\n    if (lastIframeUrl !== iframeUrl) {\n      if (baseUrl.indexOf(\"localhost:300\") === -1) {\n        const iframe = document.getElementById(\"priceData\");\n        if (iframe) (iframe as HTMLImageElement).src = iframeUrl;\n      }\n    }\n  } catch (e) {}\n}\n\nexport function generateUrl(data: {\n  prices: number[];\n  lastPattern: number;\n  maxMistakes: number;\n}) {\n  try {\n    const oldUrl = window.location.href;\n    const oldSearch = window.location.search;\n    let newSearch = oldSearch;\n    newSearch = newSearch.replace(/[\\?\\&]prices=([^&]+)/, \"\");\n    if (newSearch.indexOf(\"?\") !== -1) newSearch += \"&\";\n    else newSearch += \"?\";\n    const prices = [...data.prices];\n    prices.shift();\n    newSearch += `prices=${JSON.stringify([data.lastPattern, ...prices])}`;\n    const newUrl = oldSearch\n      ? oldUrl.replace(oldSearch, newSearch)\n      : oldUrl + newSearch;\n\n    const baseUrl = oldUrl.split(\"?\")[0];\n\n    const shareUrl =\n      baseUrl + `?prices=${JSON.stringify([data.lastPattern, ...prices])}`;\n\n    const iframeUrl = `/acnh_turnips/prices.html?p=${JSON.stringify([\n      data.lastPattern,\n      ...prices,\n    ])}${data.maxMistakes > 0 ? \"&deviation\" : \"\"}`;\n\n    return {\n      oldUrl,\n      baseUrl,\n      newUrl,\n      iframeUrl,\n      shareUrl,\n    };\n  } catch (e) {\n    return {\n      baseUrl: \"\",\n      newUrl: \"\",\n      iframeUrl: \"\",\n      shareUrl: \"\",\n    };\n  }\n}\nexport function resetUrl() {\n  try {\n    const oldUrl = window.location.href;\n    const baseUrl = oldUrl.split(\"?\")[0];\n    window.history.pushState(null, \"\", baseUrl);\n  } catch (e) {}\n}\n","import React from \"react\";\nimport { i18nGetLocale } from \"./i18n/i18n\";\nimport style from \"./LocaleSelect.module.css\";\n\nconst flags: { [locale: string]: string } = {\n  en: require(\"./i18n/flags/en.gif\"),\n  ja: require(\"./i18n/flags/jp.gif\"),\n};\n\nconsole.log(flags, flags[i18nGetLocale()]);\n\nconst locales: { [locale: string]: string } = { en: \"eng\", ja: \"\" };\n\ni18nGetLocale();\n\nexport const LocaleSelect = () => {\n  const setLocale = (loc: string) => {\n    window.location.href =\n      window.location.href.split(\"?\")[0] + \"?locale=\" + loc;\n  };\n  return (\n    <div className={style.container}>\n      <img src={flags[i18nGetLocale()] || flags[\"en\"]}></img>\n      <select\n        className={style.localeSelect}\n        onChange={(e) => setLocale(e.target.value)}\n      >\n        {Object.keys(locales).map((name, idx) => (\n          <option selected={name === i18nGetLocale()} value={name}>\n            {locales[name]}\n          </option>\n        ))}\n      </select>\n    </div>\n  );\n};\n","import React, { useEffect, useState, useMemo } from \"react\";\nimport {\n  possiblePatterns,\n  patternNames,\n  expectedPrice,\n  simulateFromPrice,\n  makeHistogram,\n  makeGroupings,\n} from \"./turnipCalculator\";\nimport { Chart, ChartData } from \"./Chart\";\nimport * as storageService from \"./storageService\";\n\nimport style from \"./Turnips.module.css\";\nimport DelayedRender from \"./DelayedRender\";\nimport { i18n, i18nJsx } from \"./i18n/i18n\";\nimport {\n  setTurnipPricesUrl,\n  getTurnipPricesUrl,\n  generateUrl,\n  resetUrl,\n} from \"./urlService\";\nimport { LocaleSelect } from \"./LocaleSelect\";\nimport image from \"./icon-128.png\";\n// import { acTurnipsPossiblePatterns } from \"./otherPatterns/acTurnipsPatterns\";\n\nconst DAYS = () => [\n  i18n(\"Sun AM: Buy\"),\n  i18n(\"Sun PM\"),\n  i18n(\"Mon AM\"),\n  i18n(\"Mon PM\"),\n  i18n(\"Tue AM\"),\n  i18n(\"Tue PM\"),\n  i18n(\"Wed AM\"),\n  i18n(\"Wed PM\"),\n  i18n(\"Thu AM\"),\n  i18n(\"Thu PM\"),\n  i18n(\"Fri AM\"),\n  i18n(\"Fri PM\"),\n  i18n(\"Sat AM\"),\n  i18n(\"Sat PM\"),\n];\n\nconst urlPrices = getTurnipPricesUrl();\n\nif (urlPrices) {\n  resetUrl();\n}\n\nconst turnipPriceStore = urlPrices || storageService.get(\"turnipPriceStore\");\nlet simulationRun = 0;\n\nlet lastLog = \"\";\nfunction logPrices(pattern: number, prices: number[]) {\n  try {\n    const log = [pattern, ...prices].map((a) => a || \"\").join(\",\");\n    if (log !== lastLog) {\n      lastLog = log;\n      // console.log(\"logging\", log);\n      (window as any).ga(\"send\", {\n        hitType: \"event\",\n        eventCategory: \"Set Price\",\n        eventAction: \"click\",\n        eventLabel: log,\n      });\n    }\n  } catch (e) {\n    console.log(e);\n  }\n}\n\nfunction deepCopy<T>(a: T): T {\n  return JSON.parse(JSON.stringify(a));\n}\n\nfunction cleanPrices(prices: number[]) {\n  while (prices?.length && !prices[prices.length - 1]) prices.pop();\n  return prices;\n}\ncleanPrices(turnipPriceStore?.prices);\n\nconst PriceForm = (props: {\n  onChange: { (price: number[], lastPattern: number): unknown };\n  currentPattern: number;\n  maxMistakes: number;\n}) => {\n  const [lastPattern, setLastPattern] = useState(\n    turnipPriceStore?.lastPattern !== undefined\n      ? turnipPriceStore.lastPattern\n      : 4\n  );\n  const [prices, setPrices] = useState<number[]>(\n    turnipPriceStore?.prices || []\n  );\n\n  const [showShare, setShowShare] = useState(false);\n\n  // useEffect(() => {\n  //   window.onpopstate = function (e: {\n  //     state: { prices: number[]; lastPattern: number; maxMistakes: number };\n  //   }) {\n  //     const data = e.state;\n  //     console.log(data);\n  //     if (data) {\n  //       setPrices(data.prices);\n  //       setLastPattern(data.lastPattern);\n  //     }\n  //   };\n  // }, []);\n\n  const changePrice = (day: number) => (e: { target: { value: string } }) => {\n    const newPrices = [...prices];\n    newPrices[day] = parseFloat(e.target.value);\n    if (day === 0) newPrices[1] = newPrices[0] || (undefined as any);\n    setPrices(newPrices);\n  };\n  const resetForm = () => {\n    if (\n      !window.confirm(\n        i18n(\n          \"Are you sure you want to reset the calculator? This cannot be undone.\"\n        )\n      )\n    )\n      return;\n    setPrices([]);\n    setLastPattern(props.currentPattern);\n  };\n  const shareLink = () => {\n    setShowShare(true);\n    setTimeout(() => {\n      try {\n        const elem = document.getElementById(\"share-link\") as HTMLInputElement;\n        if (!elem) return;\n        elem.select();\n        elem.setSelectionRange(0, 99999);\n        document.execCommand(\"copy\");\n      } catch (e) {}\n    }, 500);\n  };\n  useDebounce(() => {\n    if (!urlPrices)\n      storageService.set(\"turnipPriceStore\", { prices, lastPattern });\n    setTurnipPricesUrl({ prices, lastPattern, maxMistakes: props.maxMistakes });\n    props.onChange(prices, lastPattern);\n  }, 1000);\n  return (\n    <>\n      <div className={style.instructions}>\n        {i18n(\n          `Turnip prices change every day in the morning and at noon. Enter prices from your own island even if you purchased on a different island. Missing a few prices is ok.`\n        )}\n      </div>\n      <div>\n        {i18n(`Last week's pattern`) + \" \"}\n        <select\n          onChange={(e) => setLastPattern(parseInt(e.target.value))}\n          className={style.patternSelect}\n        >\n          {patternNames().map((name, idx) => (\n            <option selected={idx === lastPattern} value={idx}>\n              {name}\n            </option>\n          ))}\n        </select>\n      </div>\n      <div className={style.priceTable}>\n        <span className={style.formDay}>\n          <input\n            type=\"number\"\n            value={prices[0] || \"\"}\n            onChange={changePrice(0)}\n            placeholder={i18n(\"AM\")}\n          />\n          <div className={style.dayName}>{i18n(\"Buy Price\")}</div>\n        </span>\n        <span className={style.formDay}>\n          <input\n            type=\"number\"\n            value={prices[2] || \"\"}\n            onChange={changePrice(2)}\n            placeholder={i18n(\"AM\")}\n          />\n          <input\n            type=\"number\"\n            value={prices[3] || \"\"}\n            onChange={changePrice(3)}\n            placeholder={i18n(\"PM\")}\n          />\n          <div className={style.dayName}>{i18n(\"Monday\")}</div>\n        </span>\n        <span className={style.formDay}>\n          <input\n            type=\"number\"\n            value={prices[4] || \"\"}\n            onChange={changePrice(4)}\n            placeholder={i18n(\"AM\")}\n          />\n          <input\n            type=\"number\"\n            value={prices[5] || \"\"}\n            onChange={changePrice(5)}\n            placeholder={i18n(\"PM\")}\n          />\n          <div className={style.dayName}>{i18n(\"Tuesday\")}</div>\n        </span>\n        <span className={style.formDay}>\n          <input\n            type=\"number\"\n            value={prices[6] || \"\"}\n            onChange={changePrice(6)}\n            placeholder={i18n(\"AM\")}\n          />\n          <input\n            type=\"number\"\n            value={prices[7] || \"\"}\n            onChange={changePrice(7)}\n            placeholder={i18n(\"PM\")}\n          />\n          <div className={style.dayName}>{i18n(\"Wednesday\")}</div>\n        </span>\n        <span className={style.formDay}>\n          <input\n            type=\"number\"\n            value={prices[8] || \"\"}\n            onChange={changePrice(8)}\n            placeholder={i18n(\"AM\")}\n          />\n          <input\n            type=\"number\"\n            value={prices[9] || \"\"}\n            onChange={changePrice(9)}\n            placeholder={i18n(\"PM\")}\n          />\n          <div className={style.dayName}>{i18n(\"Thursday\")}</div>\n        </span>\n        <span className={style.formDay}>\n          <input\n            type=\"number\"\n            value={prices[10] || \"\"}\n            onChange={changePrice(10)}\n            placeholder={i18n(\"AM\")}\n          />\n          <input\n            type=\"number\"\n            value={prices[11] || \"\"}\n            onChange={changePrice(11)}\n            placeholder={i18n(\"PM\")}\n          />\n          <div className={style.dayName}>{i18n(\"Friday\")}</div>\n        </span>\n        <span className={style.formDay}>\n          <input\n            type=\"number\"\n            value={prices[12] || \"\"}\n            onChange={changePrice(12)}\n            placeholder={i18n(\"AM\")}\n          />\n          <input\n            type=\"number\"\n            value={prices[13] || \"\"}\n            onChange={changePrice(13)}\n            placeholder={i18n(\"PM\")}\n          />\n          <div className={style.dayName}>{i18n(\"Saturday\")}</div>\n        </span>\n        {prices.length > 2 ? (\n          <span className={style.resetForm} onClick={resetForm}>\n            {i18n(\"Reset Calculator\")}\n          </span>\n        ) : null}\n        <span className={style.shareLink} onClick={shareLink}>\n          {i18n(\"Share Link\")}\n          <input\n            id=\"share-link\"\n            type=\"text\"\n            style={{ display: showShare ? \"block\" : \"none\" }}\n            value={\n              generateUrl({\n                prices,\n                lastPattern,\n                maxMistakes: props.maxMistakes,\n              }).shareUrl\n            }\n          />\n        </span>\n      </div>\n    </>\n  );\n};\n\nfunction useDebounceFn(func: { (): unknown }, delay: number, deps: any[]) {\n  const [data] = useState({ id: (0 as unknown) as NodeJS.Timeout });\n\n  useEffect(() => {\n    clearTimeout(data.id);\n    data.id = setTimeout(() => {\n      func();\n    }, delay);\n  }, [...deps]);\n}\n\nfunction useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState(value);\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value]);\n  return debouncedValue;\n}\n\ninterface SimulationResult {\n  histogram: number[];\n  expected: number;\n  high: number;\n  low: number;\n  bucketSize: number;\n}\n\nexport const Turnips = () => {\n  // [\n  //   \"Random\",\n  //   \"Large Spike\",\n  //   \"Decreasing\",\n  //   \"Small Spike\"\n  // ];\n  const [lastPattern, setLastPattern] = useState(4);\n  const [prices, setPrices] = useState<number[]>([]);\n  // const prices = [98, 98]; // , 59, 55, 51, 48, 44, 41, 38, 120, 117, 154\n  const [simulated, setSimulated] = useState<SimulationResult | null>(null);\n\n  // account for missing buy price - not working with simulation\n  let correctedPrices = [...prices];\n  let correctedLastPattern = lastPattern;\n  let { patterns, maxMistakes } = possiblePatterns(\n    correctedPrices,\n    correctedLastPattern\n  );\n  const groupings = makeGroupings(prices, patterns);\n\n  // localhost only\n  if (patterns.length === 0) {\n    // patterns = possiblePatterns(\n    //   [correctedPrices[0], correctedPrices[0]],\n    //   correctedLastPattern\n    // ).patterns;\n    // patterns = acTurnipsPossiblePatterns(correctedPrices).patterns;\n  }\n\n  let currentDay = 0;\n  let currentPrice = 0;\n  correctedPrices.forEach((p, i) => {\n    if (p) {\n      currentDay = i;\n      currentPrice = p;\n    }\n  });\n\n  let currentPattern = patterns.reduce((last, p) => {\n    if (last === 5) return p.type;\n    if (p.type === last) return p.type;\n    return 4;\n  }, 5);\n  if (currentPattern === 5) currentPattern = 4;\n\n  const expected = expectedPrice(patterns, currentDay + 1);\n  const isDecreasing = patterns.every(\n    (p) => p.decreasingStart <= currentDay + 1\n  );\n\n  // if (patterns.length > 1) {\n  //   const masterPattern = cloneDeep(patterns[0]);\n  //   patterns.forEach(pattern => {\n  //     pattern.forEach((val, i) => {\n  //       if (masterPattern[i].high < val.high) masterPattern[i].high = val.high;\n  //       if (masterPattern[i].low > val.low) masterPattern[i].low = val.low;\n  //     });\n  //   });\n  //   patterns.unshift(masterPattern);\n  // }\n\n  const charts: ChartData[] = patterns.map((pattern) => {\n    const area = pattern.dailyPriceRange.map((p, i) => ({\n      x: i,\n      y0: p.low as number,\n      y1: p.high as number,\n    }));\n    return {\n      lines: [\n        {\n          data: pattern.dailyPriceRange.map((p, i) => ({\n            x: i,\n            y: prices[i],\n          })),\n        },\n      ],\n      areas: [{ data: area, opacity: pattern.probability * 4 }],\n      title: `${patternNames()[pattern.type]} (${\n        Math.round(pattern.probability * 1000) / 10\n      }%)`,\n    };\n  });\n\n  if (patterns.length > 1) {\n    const masterChart: ChartData = {\n      lines: [\n        {\n          data: patterns[0].dailyPriceRange.map((p, i) => ({\n            x: i,\n            y: prices[i],\n          })),\n        },\n      ],\n      areas: charts.map((c) => c.areas[0]),\n      title: i18n(\"All Possible Prices\"),\n    };\n    charts.forEach(\n      (chart) => (chart.areas[0] = { ...chart.areas[0], opacity: 1 })\n    );\n    charts.unshift(masterChart);\n  }\n\n  const simulate = async (iterations = 20) => {\n    const currentRun = ++simulationRun;\n    // console.log(\"simulate=================\", prices, lastPattern);\n    if (!charts.length) return;\n    // if (!prices.filter(Boolean).length) return;\n    let expectedPrice = 0;\n    let allPrices = [] as number[];\n    for (let i = 0; i <= iterations; i++) {\n      const res = simulateFromPrice(prices, lastPattern, 50);\n      // console.log({ ...res, allPrices: allPrices.length });\n      expectedPrice += res.expectedPrice * res.allPrices.length;\n      allPrices.push(...res.allPrices);\n      await new Promise((r) => setTimeout(r, 100));\n\n      if (currentRun !== simulationRun) return;\n      if (i && i % 10 === 0) {\n        let bucketSize = 10;\n        if (allPrices.length > 5000) bucketSize = 5;\n        let histogram = makeHistogram(allPrices, bucketSize);\n        // if (allPrices.length > 5000) histogram = histogram.map((p) => p * 2);\n        setSimulated({\n          histogram,\n          expected: expectedPrice / allPrices.length,\n          low: Math.min(...allPrices),\n          high: Math.max(...allPrices),\n          bucketSize,\n        });\n        console.log(\"simulations ran: \", allPrices.length);\n      }\n    }\n  };\n  useEffect(\n    () =>\n      setSimulated({\n        ...(simulated as SimulationResult),\n        expected: 0,\n        high: 0,\n        low: 0,\n      }),\n    [prices, lastPattern]\n  );\n  useDebounceFn(simulate, 1000, [prices, lastPattern]);\n\n  return (\n    <div className={style.container}>\n      <LocaleSelect />\n      <h1 className={style.title}>\n        <img src={image} width={32} />\n        <span>{i18n(\"Turnip Price Calculator\")}</span>\n        <img src={image} width={32} />\n      </h1>\n      <h2 className={style.subTitle}>{i18n(`Animal Crossing New Horizons`)}</h2>\n      <PriceForm\n        onChange={(prices, pattern) => {\n          logPrices(pattern, prices);\n          setPrices(prices);\n          setLastPattern(pattern);\n        }}\n        maxMistakes={maxMistakes}\n        currentPattern={currentPattern}\n      />\n      {\n        <>\n          {currentDay === 13 ? (\n            <div className={style.recommendation}>\n              {i18n(\n                \"End of the week. You should sell now or your turnips will spoil.\"\n              )}\n            </div>\n          ) : isDecreasing ? (\n            <div className={style.recommendation}>\n              {i18n(\"Sell Now!! Prices will only decrease from here.\")}\n            </div>\n          ) : maxMistakes > 0 ? (\n            <div className={style.recommendation}>\n              {i18n(\n                \"It's a bit tough to make a prediction with these prices, but see the charts below for our best guess.\"\n              )}\n            </div>\n          ) : (\n            <div\n              className={style.recommendation}\n              style={{ opacity: simulated?.expected ? 1 : 0.5 }}\n            >\n              {currentDay > 0\n                ? (simulated?.expected || expected.expected) > currentPrice\n                  ? i18n(`Recommendation is to hold.`) + \" \"\n                  : i18n(`Sell Now!!`) + \" \"\n                : null}\n              {i18nJsx(\n                \"Prices are expected to be {price} in the future with a low of {low} and a high of {high}.\",\n                {\n                  price: (\n                    <b>\n                      {Math.round(simulated?.expected || expected.expected)}\n                    </b>\n                  ),\n                  low: (\n                    <span style={{ color: \"red\" }}>\n                      {Math.min(\n                        expected.low,\n                        simulated?.low || 999,\n                        ...groupings.map((g) => g.minPrice)\n                      )}\n                    </span>\n                  ),\n                  high: (\n                    <span style={{ color: \"green\" }}>\n                      {Math.max(expected.high, simulated?.high || 0)}\n                    </span>\n                  ),\n                }\n              )}\n            </div>\n          )}\n          <div className={style.groupingContainer}>\n            {groupings\n              .filter((g) => g.probability)\n              .map((group) => {\n                return (\n                  <span\n                    className={`${style.groupingForm} ${\n                      style[`pattern${group.type}`]\n                    }`}\n                    key={group.type}\n                  >\n                    <div className={style.percent}>\n                      {Math.round(group.probability * 100)}%\n                    </div>\n                    <div>{patternNames()[group.type]}</div>\n                    <div>\n                      {group.minPrice}-{group.maxPrice}\n                    </div>\n                  </span>\n                );\n              })}\n          </div>\n          <span /* onClick={() => simulate(50)} */>\n            <Chart\n              data={{\n                lines: [\n                  {\n                    data:\n                      simulated?.histogram?.map((y, i) => ({\n                        x: i * simulated.bucketSize,\n                        y,\n                      })) || [],\n                  },\n                ],\n                areas: [],\n                title: i18n(\"Probability\"),\n              }}\n              options={{\n                xDomain: [0, 600], //histDomain.x,\n                yDomain: [0, 25], //histDomain.y,\n                yTickFormat: (a: any) => `${a}%`,\n              }}\n              calloutMessage={(selectedPoints) => {\n                const x = selectedPoints.allLines[0].x;\n                const y = selectedPoints.allLines[0].y;\n                // const day = DAYS[x];\n                // const yPos = allLines[0]?.y;\n                // const yMax = Math.max(...(allAreas || []).map(p => p.y1));\n                // const yMin = Math.min(...(allAreas || []).map(p => p.y0));\n\n                return {\n                  text: i18n(`Price {price} expected {percent}%`, {\n                    price: x,\n                    percent: Math.round(y * 10) / 10,\n                  }),\n                };\n              }}\n            />\n          </span>\n          {charts.map((chart, idx) => {\n            // make the chart lines wider instead of pointy\n            const fatData = deepCopy(chart);\n            fatData.areas.forEach((area) => {\n              area.data = area.data.flatMap((a) => [\n                { ...a, x: a?.x + 0.1 },\n                { ...a, x: a?.x + 0.9 },\n              ]);\n            });\n            const newLines: typeof fatData.lines = [];\n            let curLine: typeof newLines[0] = { data: [] };\n\n            // handle missing data\n            fatData.lines.forEach((line) => {\n              line.data.forEach((a) => {\n                if (!a.y) {\n                  if (curLine.data.length) {\n                    newLines.push(curLine);\n                    curLine = { data: [] };\n                  }\n                } else {\n                  curLine.data.push(\n                    ...[\n                      { ...a, x: a?.x + 0.1 },\n                      { ...a, x: a?.x + 0.9 },\n                    ]\n                  );\n                }\n              });\n              if (curLine.data.length) {\n                newLines.push(curLine);\n                curLine = { data: [] };\n              }\n            });\n\n            fatData.lines = newLines;\n\n            return (\n              <DelayedRender\n                width={380}\n                height={360}\n                key={`${idx}-${JSON.stringify(chart)}`}\n              >\n                <Chart\n                  data={fatData}\n                  options={{\n                    yDomain: [0, 600],\n                    xDomain: [0, 14],\n                    xTickFormat: (d: number) =>\n                      [\n                        i18n(\"Buy\"),\n                        \"\",\n                        i18n(\"Mon\"),\n                        \"\",\n                        i18n(\"Tue\"),\n                        \"\",\n                        i18n(\"Wed\"),\n                        \"\",\n                        i18n(\"Thu\"),\n                        \"\",\n                        i18n(\"Fri\"),\n                        \"\",\n                        i18n(\"Sat\"),\n                        \"\",\n                      ][d as number],\n                  }}\n                  calloutMessage={(selectedPoints) => {\n                    let x = Math.round(selectedPoints.allLines[0]?.x);\n                    if (isNaN(x)) x = Math.floor(selectedPoints.allAreas[0]?.x);\n                    const day = DAYS()[x];\n                    const yMax = Math.max(\n                      ...(selectedPoints.allAreas || []).map((p) => p.y1)\n                    );\n                    const yMin = Math.min(\n                      ...(selectedPoints.allAreas || []).map((p) => p.y0)\n                    );\n\n                    return {\n                      text: i18n(`{day} price {yMin} - {yMax}`, {\n                        day,\n                        yMin,\n                        yMax,\n                      }),\n                      xCallout: x + 0.5,\n                    };\n                  }}\n                />\n              </DelayedRender>\n            );\n          })}\n        </>\n      }\n    </div>\n  );\n};\n","import React from \"react\";\nimport \"./App.css\";\nimport { Turnips } from \"./Turnips\";\nimport { getUserLanguage, i18nSetLocale, i18n } from \"./i18n/i18n\";\n\nfunction App() {\n  const locale = getUserLanguage();\n  i18nSetLocale(locale);\n  const elem = document.getElementById(\"title\");\n  if (elem)\n    elem.innerHTML =\n      i18n(\"Turnip Price Calculator\") +\n      \": \" +\n      i18n(\"Animal Crossing New Horizons\");\n  return (\n    <div className=\"App\">\n      <Turnips />\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n\nwindow.addEventListener(\"error\", (err) => {\n  try {\n    window.ga(\"send\", \"exception\", {\n      exDescription: err.message,\n      exFatal: true,\n    });\n  } catch (err) {}\n  console.error(err);\n});\n"],"sourceRoot":""}